# Feature Specification: 人机对战（玩家黑棋）

**Feature Branch**: `001-human-vs-ai`  
**Created**: 2026-01-14  
**Status**: Draft  
**Input**: User description: "新增人机对战功能，玩家执黑棋，电脑执白棋。"

## 技术约束 *(mandatory)*

- 必须使用 Vue 2.7、Tailwind CSS、Pinia
- 禁止使用 TypeScript（仅 JavaScript）

## Clarifications

### Session 2026-01-14

- Q: 黑棋禁手规则如何处理？ → A: 与现有人人对战规则保持一致
- Q: 电脑落子策略强度？ → A: 明显更强的对手（多步前瞻，尽量争取最优）
- Q: 刷新/离开页面时对局是否保留？ → A: 不保留（刷新或离开即结束该局）

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 开始人机对战 (Priority: P1)

玩家在对局入口选择“人机对战”，系统在当前页面切换到人机对战界面，创建新对局并清晰标识玩家为黑棋、电脑为白棋，提示当前轮到玩家先手。

**Why this priority**: 这是进入人机对战模式的最小可用入口，缺失将无法开始体验。

**Independent Test**: 仅通过选择人机对战并进入棋盘即可验证对局创建与黑白分配是否正确。

**Acceptance Scenarios**:

1. **Given** 玩家在对局入口，**When** 选择“人机对战”并开始，**Then** 系统切换到人机对战界面、创建新对局、棋盘为空、玩家执黑并先手、电脑执白
2. **Given** 新对局已创建，**When** 查看对局信息，**Then** 可以清晰看到黑/白棋归属与当前轮次提示

---

### User Story 2 - 轮流落子对战 (Priority: P2)

玩家在棋盘上落子后，电脑自动落子并遵守轮次规则与合法性限制，玩家不能在电脑回合落子。

**Why this priority**: 人机对战的核心体验是“轮流下棋”，没有该能力对局无法进行。

**Independent Test**: 在已有对局中，验证玩家落子后电脑是否自动落子并正确切换回合。

**Acceptance Scenarios**:

1. **Given** 对局进行中且轮到玩家，**When** 玩家在空位落子，**Then** 落子成功并进入电脑回合
2. **Given** 电脑回合进行中，**When** 玩家尝试再次落子，**Then** 系统阻止该操作并保持轮次不变
3. **Given** 电脑完成落子，**When** 棋盘更新，**Then** 轮到玩家继续落子

---

### User Story 3 - 结束对局与再来一局 (Priority: P3)

当玩家或电脑达成胜利条件或棋盘无可用落子时，系统结束对局、展示结果，并允许玩家开始新一局。

**Why this priority**: 清晰的胜负结果和再开一局是对战闭环体验的重要组成部分。

**Independent Test**: 通过构造胜负或平局局面验证结果展示与再开一局流程。

**Acceptance Scenarios**:

1. **Given** 玩家形成胜利条件，**When** 玩家落下最后一子，**Then** 系统结束对局并显示“玩家胜利”
2. **Given** 电脑形成胜利条件或棋盘已满，**When** 对局结束判定触发，**Then** 系统显示对应结果（玩家失败或平局）
3. **Given** 对局已结束，**When** 玩家选择“再来一局”，**Then** 系统创建新对局且玩家执黑先手

---

### Edge Cases

- 玩家点击已被占用的棋位时，系统应阻止并给出提示
- 玩家在电脑回合连续快速点击时，系统应忽略额外落子并保持回合一致性
- 棋盘已满且无胜者时，应判定为平局并结束对局
- 对局结束后，继续落子操作应被阻止并提示结果已确定

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统 MUST 提供“人机对战”入口以便玩家创建新对局
- **FR-002**: 系统 MUST 在人机对战中固定分配玩家为黑棋、电脑为白棋，并清晰展示先手与当前轮次
- **FR-003**: 系统 MUST 仅允许在空棋位落子，并在非法落子时阻止操作并提示原因
- **FR-004**: 玩家落子后系统 MUST 自动完成电脑落子并切换回合回到玩家
- **FR-005**: 系统 MUST 在任一方达成胜利条件或棋盘无合法落子时结束对局并展示结果（玩家胜/负/平局）
- **FR-006**: 对局结束后用户 MUST 能通过“再来一局”开始新对局，且仍由玩家执黑先手
- **FR-007**: 系统 MUST 在电脑回合期间阻止玩家继续落子操作
- **FR-008**: 系统 MUST 使用与现有人人对战一致的胜负与禁手规则；若人人对战启用黑棋禁手，则人机对战也启用
- **FR-009**: 系统 MUST 在存在直接获胜或必须防守的局面时让电脑优先选择对应落子，以保证对抗性
- **FR-010**: 系统 MUST 将人机对战对局视为一次性会话，刷新或离开页面视为结束该局

### Key Entities *(include if feature involves data)*

- **对局**: 表示一盘人机对战，包含参与者（玩家/电脑）、当前轮次、对局状态、结果
- **棋子落点**: 表示一次落子，包含颜色、位置、顺序
- **棋盘状态**: 表示当前棋盘占用情况与可落子位置
- **参与者**: 表示玩家或电脑，包含执棋颜色与类型（人类/电脑）

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 人工验收样本中，至少 95% 的人机对战可从开始到结束完整走完一局且无需刷新页面
- **SC-002**: 玩家落子后，电脑落子在 2 秒内完成并更新棋盘
- **SC-003**: 人工验收样本中，至少 90% 的玩家能在第一次尝试中完成一局并看到明确结果
- **SC-004**: 从点击“人机对战开始”到玩家可落子状态的等待时间不超过 3 秒

## Assumptions

- 沿用现有五子棋的胜负判定规则与棋盘尺寸
- 仅提供默认电脑对手难度，不提供难度选择

## Scope

- **In Scope**: 人机对战入口、固定黑白分配、轮流落子、胜负/平局判定、对局结果展示、再来一局
- **Out of Scope**: 难度选择、悔棋、提示/教学、存档/回放、在线对战或排行榜
